flowchart TB
%% Farben: HL7 vs DICOM klar unterscheiden
classDef system fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#000
classDef backend fill:#ffebee,stroke:#c62828,stroke-width:2px,color:#000
classDef hl7 fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,color:#000
classDef dicom fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,color:#000

%% Bereiche / Systeme
subgraph Verwaltung["ğŸ¥ Verwaltung (KIS / RIS / LIS)"]
    direction LR
    KIS["ğŸ–¥ï¸ KIS<br/>(Patientenaufnahme)"]
    RIS["ğŸ“‹ RIS<br/>(Radiologie-Auftrag)"]
    LIS["ğŸ§ª LIS<br/>(Labor)"]
end

subgraph Backend["ğŸ’¾ Backend (Orthanc)"]
    direction LR
    MWLServer["ğŸ“‹ Worklist-Server (MWL)<br/>(Terminliste fÃ¼r ModalitÃ¤ten)"]
    PACS["ğŸ“¦ PACS-Archiv<br/>(Bilder + Studien)"]
end

subgraph Untersuchung["â˜¢ï¸ Untersuchungsraum"]
    direction TB
    Modality["â˜¢ï¸ CT Scanner<br/>(ModalitÃ¤t)"]
end

subgraph Befundung["ğŸ‘¨â€âš•ï¸ Befundung"]
    direction TB
    Workstation["ğŸ–¥ï¸ Workstation<br/>(Viewer)"]
end

%% Prozess-Schritte als eigene Knoten (damit Text nicht auf Linien liegt)
ADT["1) HL7 ADT<br/>Patientendaten"]
ORU["2) HL7 ORU<br/>Kreatinin"]
ORM["3) HL7 ORM<br/>Auftrag"]
MWL["4) DICOM C-FIND<br/>Worklist"]
STORE["5) DICOM C-STORE<br/>Bilder"]
QFIND["6) DICOM C-FIND<br/>Studienliste"]
CMOVE["7) DICOM C-MOVE<br/>Retrieve"]
WSSTORE["(RÃ¼ckkanal) DICOM C-STORE<br/>Bilder an Workstation"]

%% Apply Styles
class KIS,RIS,LIS,Modality,Workstation system
class MWLServer,PACS backend
class ADT,ORU,ORM hl7
class MWL,STORE,QFIND,CMOVE,WSSTORE dicom

%% Datenfluss (HL7 gestrichelt, DICOM durchgezogen)
KIS -.-> ADT -.-> RIS
RIS -.-> ORU -.-> LIS
RIS -.-> ORM -.-> MWLServer

MWLServer --> MWL --> Modality
Modality --> STORE --> PACS

Workstation --> QFIND --> PACS
Workstation --> CMOVE --> PACS
PACS --> WSSTORE --> Workstation